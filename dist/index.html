<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./index.css">
  <title>Document</title>
</head>

<body>
  <img src="" alt="">
  <canvas></canvas>
  <input type="file">
  <script src='./index.js'>
    console.log(tools);
  </script>
  <script>
    let img = document.querySelector('img')
    let canvas = document.querySelector('canvas')
    let ctx = canvas.getContext('2d')
    function base64ToBlob(base64) {
      try {
        let arr = base64.split(',')
        let mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {
          type: mime,
        })
      } catch (e) {
        return e
      }
    }
    let input = document.querySelector('input')
    input.onchange = function (e) {
      let fr = new FileReader()
      fr.readAsDataURL(e.target.files[0])
      window.file = e.target.files[0]
      ctx.drawImage(img, 0, 0, img.offsetWidth, img.offsetHeight)
      fr.onload = function (result) {
        let base64 = result.target.result
        let blob = base64ToBlob(base64)
        window.base64 = base64
        draw(blob)
      }
    }
    function draw(blob) {
      let fr = new FileReader()
      fr.readAsDataURL(blob)
      fr.onload = e => {
        img.src = e.target.result
      }
    }
  </script>
</body>

</html>